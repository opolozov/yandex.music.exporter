# Yandex Music Exporter

Клиент для экспорта музыки из Яндекс.Музыки на Go. Позволяет просматривать плейлисты, избранные треки и скачивать их с сохранением ID3 тегов.


## Установка

### Требования

- Go 1.19 или выше
- Токен доступа к API Яндекс.Музыки

### Получение токена доступа

Инструкция по получению токена доступа описана в [документации](https://yandex-music.readthedocs.io/en/main/token.html).

### Сборка

#### Из исходников

```bash
git clone <repository-url>
cd yandex.music.exporter
go mod download
go build -o yandex-music-exporter main.go
```

#### Готовые сборки

Готовые бинарники для разных платформ доступны в [Releases](https://github.com/opolozov/yandex.music.exporter/releases).

Поддерживаемые платформы:
- Linux (amd64, arm64)
- macOS (amd64, arm64)
- Windows (amd64)

## Настройка

1. Скопируйте файл `env.example` в `.env`:
```bash
cp env.example .env
```

2. Откройте `.env` и укажите ваш токен доступа:
```
ACCESS_TOKEN=ваш_токен_здесь
```

## Использование

### Команды

#### Просмотр списка плейлистов

```bash
./yandex-music-exporter -cmd=list-playlists
```

**Как работает:**
1. Получает информацию о текущем пользователе
2. Запрашивает список всех плейлистов пользователя
3. Выводит название и ID каждого плейлиста

Вывод в формате `{название} \t {id}`.

Для JSON вывода:
```bash
./yandex-music-exporter -cmd=list-playlists -out=json
```

#### Просмотр треков в плейлисте

```bash
./yandex-music-exporter -cmd=playlist -id=a1b2c3d4-e5f6-7890-abcd-ef1234567890
```

**Как работает:**
1. Получает информацию о текущем пользователе
2. Если ID плейлиста — UUID, сначала получает список всех плейлистов и находит нужный по UUID, затем использует его числовой `kind`
3. Если ID плейлиста — число, использует его напрямую как `kind`
4. Запрашивает плейлист по найденному `kind`
5. Для каждого трека получает ссылку на MP3 и формирует прямую ссылку на скачивание
6. Выводит название трека, исполнителя и ссылку на MP3

Вывод в формате `{название} — {исполнитель} \t {ссылка_на_mp3}`.

Для JSON вывода:
```bash
./yandex-music-exporter -cmd=playlist -id=a1b2c3d4-e5f6-7890-abcd-ef1234567890 -out=json
```

**Форматы ID плейлиста:**
- UUID: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`
- Числовой kind: `12345`
- С owner_id: `owner_id:playlist_id`

#### Просмотр лайкнутых треков

```bash
./yandex-music-exporter -cmd=likes
```

**Как работает:**
1. Получает информацию о текущем пользователе
2. Запрашивает список лайкнутых треков
3. Для каждого трека из списка получает полную информацию
4. Для каждого трека получает ссылку на MP3 и формирует прямую ссылку на скачивание
5. Выводит название трека, исполнителя и ссылку на MP3

Вывод в формате `{название} — {исполнитель} \t {ссылка_на_mp3}`.

Для JSON вывода:
```bash
./yandex-music-exporter -cmd=likes -out=json
```

#### Скачивание плейлиста

```bash
./yandex-music-exporter -cmd=download-playlist -id=a1b2c3d4-e5f6-7890-abcd-ef1234567890 -to=./music
```

**Как работает:**
1. Получает список треков плейлиста (аналогично команде `playlist`)
2. Создаёт указанную папку, если её нет
3. Для каждого трека:
   - Формирует имя файла в формате `{исполнитель}-{название}.mp3` и очищает от недопустимых символов
   - Проверяет, существует ли файл — если да, пропускает
   - Получает ссылку на MP3
   - Скачивает файл с отображением прогресса в процентах
   - Записывает ID3 теги (название, исполнитель, альбом, год, жанр, номер трека, URI обложки)
4. В конце выводит статистику: скачано, пропущено, ошибок

Треки будут скачаны в папку `./music` с именами файлов в формате `{исполнитель}-{название}.mp3`. Уже существующие файлы будут пропущены.

#### Скачивание лайкнутых треков

```bash
./yandex-music-exporter -cmd=download-likes -to=./likes
```

**Как работает:**
1. Получает список лайкнутых треков (аналогично команде `likes`)
2. Создаёт указанную папку, если её нет
3. Для каждого трека:
   - Формирует имя файла в формате `{исполнитель}-{название}.mp3` и очищает от недопустимых символов
   - Проверяет, существует ли файл — если да, пропускает
   - Получает ссылку на MP3
   - Скачивает файл с отображением прогресса в процентах
   - Записывает ID3 теги (название, исполнитель, альбом, год, жанр, номер трека, URI обложки)
4. В конце выводит статистику: скачано, пропущено, ошибок

Все лайкнутые треки будут скачаны в папку `./likes`.

### Параметры

- `-cmd` — команда для выполнения (обязательный):
  - `list-playlists` — список плейлистов
  - `playlist` — треки плейлиста
  - `likes` или `favorites` — лайкнутые треки
  - `download-playlist` — скачать плейлист
  - `download-likes` — скачать лайкнутые треки
- `-id` — ID плейлиста (для команд `playlist` и `download-playlist`)
- `-to` — папка для сохранения (для команд `download-playlist` и `download-likes`)
- `-out` — формат вывода: `text` (по умолчанию) или `json` (для команд `playlist`, `likes`, `list-playlists`)

## ID3 Теги

При скачивании треков автоматически записываются следующие ID3 теги:

- **Title** — название трека
- **Artist** — исполнитель(и)
- **Album** — альбом
- **Year** — год выпуска
- **Track Number** — номер трека в альбоме
- **Genre** — жанр
- **Cover Art URL** — URI обложки альбома (в пользовательском текстовом фрейме TXXX)

## Примеры

### Просмотр всех плейлистов

```bash
./yandex-music-exporter -cmd=list-playlists
```

### Просмотр треков плейлиста в JSON

```bash
./yandex-music-exporter -cmd=playlist -id=a1b2c3d4-e5f6-7890-abcd-ef1234567890 -out=json
```

### Скачать плейлист

```bash
./yandex-music-exporter -cmd=download-playlist -id=a1b2c3d4-e5f6-7890-abcd-ef1234567890 -to=./my_playlist
```

### Скачать все лайкнутые треки

```bash
./yandex-music-exporter -cmd=download-likes -to=./my_likes
```

## Структура проекта

```
.
├── main.go              # Основной код приложения
├── go.mod               # Зависимости Go
├── go.sum               # Checksums зависимостей
├── .env                 # Токен доступа (не коммитится)
├── env.example          # Пример файла .env
├── .gitignore           # Игнорируемые файлы
└── README.md            # Этот файл
```

## Зависимости

- `github.com/joho/godotenv` — загрузка переменных окружения из `.env`
- `github.com/bogem/id3v2` — работа с ID3 тегами

## Примечания

- Токен доступа должен храниться в безопасности и не передаваться третьим лицам
- Скачанные файлы сохраняются с именами в формате `{исполнитель}-{название}.mp3`
- Если файл уже существует, он будет пропущен при скачивании
- Прогресс скачивания отображается в реальном времени с процентами

## Лицензия

MIT

